<script>
  import "../styles/fonts.css";
  import "../styles/constants.css";
  import "../styles/interactive-elements.css";

  const defaultMapSvg = `<svg width="278" height="187" viewBox="0 0 278 187" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M270.278 0C274.6 0 278.105 3.50413 278.105 7.82617V326.287H276.976V7.82617C276.976 4.12758 273.977 1.12891 270.278 1.12891H17.0899C14.0085 1.12915 11.5098 3.62751 11.5098 6.70898V22.7412C11.5095 23.4084 10.969 23.9501 10.3018 23.9502C5.24043 23.9504 1.13676 28.0538 1.13676 33.1152V59.8174C1.13702 64.8786 5.24059 68.9822 10.3018 68.9824C10.9691 68.9826 11.5098 69.524 11.5098 70.1914V98.9854C11.5095 99.6525 10.969 100.194 10.3018 100.194C5.24043 100.195 1.13676 104.298 1.13676 109.359V136.58C1.13702 141.641 5.24059 145.745 10.3018 145.745C10.9691 145.745 11.5098 146.287 11.5098 146.954V175.229C11.5095 175.897 10.969 176.438 10.3018 176.438C5.24054 176.439 1.13695 180.541 1.13676 185.603V212.824C1.13702 217.885 5.24059 221.989 10.3018 221.989C10.969 221.989 11.5096 222.53 11.5098 223.197V251.474C11.5095 252.141 10.9689 252.682 10.3018 252.682C5.24048 252.682 1.13684 256.785 1.13676 261.847V289.068C1.13704 294.13 5.2406 298.233 10.3018 298.233C10.969 298.234 11.5097 298.774 11.5098 299.441V328.236C11.5094 328.903 10.9689 329.444 10.3018 329.444C5.24045 329.445 1.1368 333.548 1.13676 338.609V365.312C1.13715 370.374 5.24066 374.477 10.3018 374.478C10.9691 374.478 11.5098 375.018 11.5098 375.686V390.961C11.5103 393.888 13.8837 396.26 16.8106 396.261H114.68V397.39H16.8106C13.2602 397.389 10.3814 394.511 10.3809 390.961V375.686C10.3809 375.642 10.3457 375.606 10.3018 375.605C4.61721 375.605 0.00823962 370.997 0.00785446 365.312V338.609C0.00788893 332.925 4.61699 328.316 10.3018 328.315C10.3454 328.315 10.3805 328.28 10.3809 328.236V299.441C10.3808 299.398 10.3456 299.362 10.3018 299.362C4.61715 299.362 0.00813172 294.753 0.00785446 289.068V261.847C0.00793433 256.162 4.61702 251.553 10.3018 251.553C10.3455 251.553 10.3806 251.517 10.3809 251.474V223.197C10.3807 223.154 10.3455 223.118 10.3018 223.118C4.61714 223.118 0.00811502 218.509 0.00785446 212.824V185.603C0.00804204 179.918 4.61709 175.31 10.3018 175.31C10.3455 175.309 10.3806 175.273 10.3809 175.229V146.954C10.3809 146.91 10.3457 146.874 10.3018 146.874C4.61714 146.874 0.00811502 142.265 0.00785446 136.58V109.359C0.00785446 103.674 4.61697 99.0657 10.3018 99.0654C10.3455 99.0653 10.3806 99.029 10.3809 98.9854V70.1914C10.3809 70.1475 10.3457 70.1115 10.3018 70.1113C4.61714 70.1111 0.00811502 65.502 0.00785446 59.8174V33.1152C0.00785446 27.4304 4.61697 22.8215 10.3018 22.8213C10.3455 22.8211 10.3806 22.7849 10.3809 22.7412V6.70898C10.3809 3.00406 13.385 0.000241407 17.0899 0H270.278ZM278.105 389.564C278.104 393.886 274.6 397.39 270.278 397.39H164.472V396.261H270.278C273.977 396.261 276.975 393.263 276.976 389.564V375.041H278.105V389.564Z" fill="#B2987E"/>
<path d="M119.676 88.0967H76.2687C75.0221 88.0969 74.011 89.1078 74.0109 90.3545V140.816H119.677V141.945H74.0109V195.227H119.677V196.355H74.0109V249.639H119.677V250.768H74.0109V304.05H119.677V305.179H74.0109V355.637C74.0109 356.883 75.022 357.894 76.2687 357.895H119.676V359.023H76.2687L76.0939 359.02C74.305 358.928 72.882 357.448 72.882 355.637V90.3545C72.8821 88.5429 74.305 87.0638 76.0939 86.9727L76.2687 86.9678H119.676V88.0967ZM214.229 86.9678C216.099 86.9679 217.615 88.4843 217.615 90.3545V355.637C217.615 357.507 216.099 359.023 214.229 359.023H171.91V357.895H214.229C215.476 357.894 216.487 356.884 216.487 355.637V305.179H171.912V304.05H216.487V250.768H171.912V249.639H216.487V196.355H171.912V195.227H216.487V141.945H171.912V140.816H216.487V90.3545C216.486 89.1077 215.475 88.0968 214.229 88.0967H171.91V86.9678H214.229Z" fill="#B2987E"/>
<path d="M77.3965 41.2488H22.0823C21.4588 41.2488 20.9534 40.7434 20.9534 40.1199V37.2978C20.9534 36.6743 21.4588 36.1689 22.0823 36.1689H72.3166C73.5635 36.1689 74.5743 35.1581 74.5743 33.9112V12.4628C74.5743 11.2159 75.5852 10.2051 76.8321 10.2051H225.277C226.524 10.2051 227.535 11.2159 227.535 12.4628V33.9112C227.535 35.1581 228.546 36.1689 229.793 36.1689H268.174C268.798 36.1689 269.303 36.6743 269.303 37.2978V40.1199C269.303 40.7434 268.798 41.2488 268.174 41.2488H224.713C223.466 41.2488 222.455 40.238 222.455 38.9911V17.5427C222.455 16.2958 221.444 15.285 220.198 15.285H81.9119C80.665 15.285 79.6542 16.2958 79.6542 17.5427V38.9911C79.6542 40.238 78.6434 41.2488 77.3965 41.2488Z" fill="#B2987E" fill-opacity="0.3" stroke="#B2987E" stroke-width="1.12886"/>
<rect x="59" y="102.046" width="28" height="28" rx="14" fill="#B2987E"/>
<path d="M73.3594 108.046C73.3594 108.542 73.4548 108.903 73.6895 109.146C73.9236 109.388 74.3578 109.576 75.1836 109.576C75.846 109.576 76.3411 109.398 76.8809 109.203C77.4201 109.008 78.0041 108.796 78.7822 108.796C79.982 108.796 80.6962 109.752 80.5957 110.735C80.9935 110.885 81.2843 111.107 81.4805 111.38C81.7152 111.707 81.7969 112.077 81.7969 112.415C81.7968 112.882 81.6968 113.222 81.6084 113.535C81.5212 113.844 81.4424 114.132 81.4424 114.542C81.4424 115.079 81.5327 115.362 81.6699 115.517C81.7983 115.661 82.0289 115.76 82.5 115.76V116.36C82.016 116.36 81.79 116.446 81.666 116.581C81.5345 116.724 81.4424 117 81.4424 117.578C81.4424 117.945 81.5187 118.195 81.6074 118.498C81.6982 118.808 81.7968 119.158 81.7969 119.677C81.7969 120.475 81.2752 121.102 80.6162 121.377C80.6865 121.848 80.5171 122.297 80.2305 122.637C79.8857 123.045 79.3506 123.324 78.7822 123.324C78.0041 123.324 77.4201 123.112 76.8809 122.917C76.3411 122.722 75.846 122.545 75.1836 122.545C74.4155 122.545 73.9737 122.729 73.7227 122.976C73.4728 123.221 73.3594 123.58 73.3594 124.046H72.7588C72.7588 123.57 72.6585 123.213 72.4248 122.971C72.1923 122.73 71.7708 122.545 70.9941 122.545C70.2952 122.545 69.7702 122.723 69.2031 122.918C68.6363 123.113 68.027 123.324 67.2178 123.324C66.6825 123.324 66.1629 123.109 65.8135 122.717C65.5089 122.375 65.3473 121.914 65.4043 121.383C64.4658 121.014 64.2031 120.212 64.2031 119.677C64.2032 119.216 64.3031 118.864 64.3916 118.547C64.48 118.23 64.5576 117.948 64.5576 117.578C64.5576 117.025 64.4671 116.744 64.332 116.594C64.2054 116.453 63.9761 116.36 63.5 116.36V115.76L63.6631 115.755C64.0201 115.733 64.2133 115.636 64.3281 115.504C64.4688 115.342 64.5576 115.055 64.5576 114.542C64.5576 114.166 64.479 113.88 64.3906 113.559C64.3021 113.237 64.2032 112.88 64.2031 112.415C64.2031 111.597 64.7198 110.959 65.3945 110.721C65.2949 109.768 66.071 108.796 67.2178 108.796C68.0252 108.796 68.6674 109.006 69.252 109.201C69.8422 109.398 70.3645 109.576 70.9941 109.576C71.7627 109.576 72.1844 109.391 72.4189 109.146C72.6255 108.931 72.7307 108.625 72.7539 108.224L72.7588 108.046H73.3594ZM73.0547 109.297C72.9966 109.39 72.9308 109.48 72.8516 109.562C72.4593 109.971 71.8478 110.176 70.9941 110.176C70.252 110.176 69.6393 109.963 69.0615 109.771C68.4782 109.576 67.9184 109.396 67.2178 109.396C66.3358 109.396 65.8267 110.213 66.0283 110.849L66.1328 111.179L65.792 111.235C65.2495 111.326 64.8027 111.79 64.8027 112.415C64.8028 112.791 64.8813 113.077 64.9697 113.398C65.0583 113.72 65.1572 114.077 65.1572 114.542C65.1572 115.093 65.0683 115.566 64.7812 115.896C64.7312 115.954 64.6755 116.004 64.6172 116.05C64.6737 116.092 64.7284 116.138 64.7773 116.192C65.0701 116.518 65.1572 116.997 65.1572 117.578C65.1572 118.038 65.0573 118.391 64.9688 118.708C64.8803 119.025 64.8028 119.307 64.8027 119.677C64.8027 120.06 64.9952 120.666 65.8213 120.892L66.1016 120.968L66.0342 121.251C65.9235 121.712 66.0411 122.072 66.2607 122.318C66.4866 122.572 66.8385 122.725 67.2178 122.725C67.9165 122.725 68.4408 122.546 69.0078 122.351C69.5747 122.156 70.1847 121.944 70.9941 121.944C71.8545 121.944 72.4657 122.149 72.8564 122.554C72.9413 122.642 73.01 122.738 73.0703 122.838C73.1358 122.736 73.2117 122.637 73.3027 122.548C73.7081 122.15 74.3294 121.944 75.1836 121.944C75.9618 121.944 76.5457 122.158 77.085 122.353C77.6247 122.548 78.1199 122.725 78.7822 122.725C79.1577 122.725 79.5308 122.536 79.7725 122.25C80.0114 121.967 80.1002 121.617 79.9766 121.286L79.8594 120.972L80.1846 120.89C80.7545 120.747 81.1973 120.264 81.1973 119.677C81.1972 119.245 81.1183 118.961 81.0322 118.667C80.944 118.366 80.8428 118.041 80.8428 117.578C80.8428 116.979 80.9284 116.496 81.2246 116.174C81.2677 116.127 81.3154 116.087 81.3643 116.05C81.3135 116.009 81.2651 115.965 81.2207 115.915C80.9303 115.588 80.8428 115.111 80.8428 114.542C80.8428 114.045 80.9415 113.69 81.0312 113.372C81.1198 113.059 81.1972 112.79 81.1973 112.415C81.1973 112.171 81.1382 111.931 80.9932 111.729C80.8502 111.531 80.6042 111.342 80.1807 111.229L79.8916 111.152L79.9678 110.863C80.1563 110.149 79.6811 109.396 78.7822 109.396C78.1199 109.396 77.6247 109.573 77.085 109.768C76.5457 109.962 75.9618 110.176 75.1836 110.176C74.2834 110.176 73.6543 109.973 73.2578 109.562C73.178 109.48 73.1123 109.39 73.0547 109.297ZM78.8408 112.046C78.8408 111.825 78.6622 111.646 78.4414 111.646H67.5C67.2791 111.646 67.0996 111.825 67.0996 112.046V120.046C67.0996 120.267 67.2791 120.446 67.5 120.446H78.4414C78.6622 120.446 78.8408 120.267 78.8408 120.046V112.046ZM79.4414 120.046L79.4355 120.148C79.3876 120.619 79.0137 120.993 78.543 121.041L78.4414 121.046H67.5C66.9823 121.046 66.5562 120.653 66.5049 120.148L66.5 120.046V112.046L66.5049 111.943C66.5562 111.439 66.9823 111.046 67.5 111.046H78.4414L78.543 111.051C79.0137 111.098 79.3876 111.473 79.4355 111.943L79.4414 112.046V120.046Z" fill="#FFFCF8"/>
</svg>
`;

  export let title = "Экспонат";
  export let subtitle = "";
  export let description = "";
  export let imageUrl = "";
  export let imageAlt = "";
  export let floorLabel = "";
  export let mapSvg = defaultMapSvg;
  export let footerText = "Подойдите к экспонату и нажмите кнопку";
  export let buttonText = "Начать";
  export let onNext = () => {};
  export let onBack = () => {};

  $: computedMap = mapSvg || defaultMapSvg;
</script>

<div class="intro-screen">
  <header class="topbar">
    <button class="back-btn" type="button" aria-label="Назад" on:click={onBack}>←</button>
  </header>

  <div class="body">
    <div class="titles">
      <h1>{title}</h1>
      {#if subtitle}
        <p class="subtitle">{subtitle}</p>
      {/if}
    </div>

    {#if imageUrl}
      <div class="hero">
        <img src={imageUrl} alt={imageAlt || title} />
      </div>
    {/if}

    {#if description}
      <p class="description">{description}</p>
    {/if}

    <div class="map-block">
      {#if floorLabel}
        <div class="floor-label">{floorLabel}</div>
      {/if}
      <div class="map" aria-hidden="true">
        {@html computedMap}
      </div>
    </div>
  </div>

  <footer class="footer">
    <p class="footer-text">{footerText}</p>
    <button class="cta-button" type="button" on:click={onNext}>{buttonText}</button>
  </footer>
</div>

<style>
  :global(body) {
    background: #fefcf8;
  }

  .intro-screen {
    height: 100%;
    background: #fefcf8;
    color: rgba(24, 22, 15, 1);
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding: 18px 18px 0;
  }

  .topbar {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    min-height: 42px;
  }

  .back-btn {
    width: 42px;
    height: 42px;
    border-radius: 14px;
    border: 1px solid rgba(24, 22, 15, 0.12);
    background: #fff;
    font-size: 18px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 10px 22px rgba(24, 22, 15, 0.08);
    color: inherit;
  }

  .body {
    display: flex;
    flex-direction: column;
    gap: 16px;
    align-items: center;
    padding: 0 6px;
    flex: 1;
    overflow-y: auto;
  }

  .titles {
    text-align: center;
  }

  .titles h1 {
    margin: 0;
    font-family: "Prata", "Times New Roman", serif;
    font-size: 32px;
    line-height: 1.2;
    color: rgba(24, 22, 15, 1);
  }

  .subtitle {
    margin: 6px 0 0;
    font-family: "Inter", sans-serif;
    font-size: 16px;
    line-height: 1.2;
    color: rgba(24, 22, 15, 0.8);
  }

  .hero {
    width: 100%;
      min-height: 150px;
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid rgba(178, 152, 126, 0.7);
    background: #fff;
  }

  .hero img {
    width: 100%;
    height: auto;
    display: block;
    object-fit: cover;
  }

  .description {
    margin: 0;
    text-align: center;
    font-family: "Inter", sans-serif;
    font-weight: 400;
    font-size: 16px;
    line-height: 1.2;
    letter-spacing: 0;
    color: rgba(24, 22, 15, 0.82);
  }

  .map-block {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
  }

  .floor-label {
    font-family: "Prata", "Times New Roman", serif;
    font-size: 18px;
    color: var(--accent, #b2987e);
  }

  .map {
    width: 100%;
    max-width: 340px;
  }

  .map :global(svg) {
    width: 100%;
    height: auto;
    display: block;
  }

  .footer {
    margin: auto -20px 0;
    background: rgba(255, 252, 248, 0.96);
    padding: 16px 18px 18px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    border-top: 1px solid rgba(178, 152, 126, 0.6);
    border-left: 1px solid rgba(178, 152, 126, 0.45);
    border-right: 1px solid rgba(178, 152, 126, 0.45);
  }

  .footer-text {
    margin: 0;
    text-align: center;
    font-family: "Inter", sans-serif;
    font-weight: 400;
    font-size: 16px;
    line-height: 1.2;
    color: rgba(24, 22, 15, 0.88);
  }

  .cta-button {
    width: 100%;
    min-height: 51px;
    border-radius: 100px;
    border: none;
    background: rgba(178, 152, 126, 1);
    color: #fff;
    font-family: "Inter", sans-serif;
    font-size: 16px;
    font-weight: 600;
    line-height: 1;
    cursor: pointer;
    box-shadow: 0 8px 20px rgba(24, 22, 15, 0.12);
    transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s ease;
  }

  .cta-button:active {
    transform: translateY(1px) scale(0.99);
    box-shadow: 0 6px 14px rgba(24, 22, 15, 0.1);
  }
</style>
